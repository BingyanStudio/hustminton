<!--index.wxml-->
<view class="top-images">
  <image class="logo-img" src="/images/åç§‘æ ¡å¾½.jpeg" mode="aspectFit" />
  <image class="logo-img" src="/images/Image_1752148852453.jpg" mode="aspectFit" />
</view>
<view class="container">
  <view class="filter-grid">
    <picker class="filter-cell date-cell" mode="date" value="{{selectedDate}}" bindchange="onDatePickerChange">
      <view class="icon">ğŸ“…</view>
      <view class="text">{{selectedTimeSlot && selectedTimeSlot !== 'ä¸é™' ? selectedTimeSlot : 'æ—¶é—´'}}</view>
    </picker>
    <picker class="filter-cell project-cell" mode="selector" range="{{projectOptions}}" value="{{projectIndex}}" bindchange="onProjectChange">
      <view class="icon">ğŸ¸</view>
      <view class="text">{{projectIndex > 0 ? projectOptions[projectIndex] : 'é¡¹ç›®'}}</view>
    </picker>
    <picker class="filter-cell location-cell" mode="selector" range="{{locationOptions}}" value="{{locationIndex}}" bindchange="onLocationChange">
      <view class="icon">ğŸ“</view>
      <view class="text">{{locationIndex > 0 ? locationOptions[locationIndex] : 'åœ°ç‚¹'}}</view>
    </picker>
    <picker class="filter-cell level-cell" mode="selector" range="{{levelOptions}}" value="{{levelIndex}}" bindchange="onLevelChange">
      <view class="icon">â­</view>
      <view class="text">{{levelIndex > 0 ? levelOptions[levelIndex] : 'ç­‰çº§'}}</view>
    </picker>
  </view>
  <!-- æ—¶é—´æ®µå¼¹çª— -->
  <view wx:if="{{showTimeSheet}}" class="time-sheet-mask" catchtap="onCloseTimeSheet">
    <view class="time-sheet">
      <view class="sheet-title">è¯·é€‰æ‹©æ—¶é—´æ®µ</view>
      <view class="sheet-option" wx:for="{{timeSlotOptions}}" wx:key="index" data-index="{{index}}" bindtap="onTimeSlotSelect">
        {{item}}
      </view>
    </view>
  </view>

  <!-- çº¦çƒåˆ—è¡¨ -->
  <scroll-view class="match-list" scroll-y="true" bindscrolltolower="onLoadMore">
    <view class="match-item" wx:for="{{matchList}}" wx:key="_id">
      <view class="card-header">
        <view class="card-title-row">
          <text class="place">{{item.location}}</text>
          <text class="space">  </text>
          <text class="project">{{item.project}}</text>
        </view>
        <view class="card-status-circle {{item.isFull ? 'full' : 'not-full'}}"></view>
      </view>
      <view class="card-info-row">
        <text class="card-time">{{item.date}} {{item.timeSlot}}</text>
      </view>
      <view class="card-info-row">
        <text class="card-level">ç­‰çº§ï¼š{{item.level}}</text>
      </view>
      <view class="card-info-row">
          <text class="card-player-count">åœºåœ°äººæ•°ï¼š{{item.playerCount}}</text>
          <text style="margin-left: 40rpx;">æäººäººæ•°ï¼š{{item.recruitCount !== undefined ? item.recruitCount : '-'}}</text>
        </view>
        <view class="card-expand-btn" bindtap="onToggleExpand" data-match-id="{{item._id}}">
          <text>{{expandedMatches[item._id] ? 'æ”¶èµ·' : 'å±•å¼€'}}</text>
        </view>
      <view wx:if="{{expandedMatches[item._id]}}" class="card-detail">
        <view class="card-contact">è”ç³»æ–¹å¼ï¼š{{item.contact}}</view>
        <view class="card-desc">å¤‡æ³¨ï¼š{{item.description}}</view>
        <view class="card-detail-bottom-row">
          <view class="card-avatars">
            <block wx:for="{{item.participants}}" wx:key="_id" wx:for-item="person">
              <image class="avatar {{person.isPublisher ? 'publisher-avatar' : ''}}" src="{{person.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill" bindtap="onAvatarTap" data-id="{{person._id}}" />
            </block>
          </view>
          <button class="join-btn {{item.isFull ? 'disabled' : ''}}"
                  bindtap="onJoinMatch"
                  data-id="{{item._id}}"
                  disabled="{{item.isFull}}">
            {{item.isFull ? 'å·²æ»¡' : 'åŠ å…¥'}}
          </button>
        </view>
      </view>
    </view>
  </scroll-view>
  
  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore}}">
    <text>è®©ç¾½æ¯›çƒé£ä¸€ä¼š...</text>
  </view>
  <view class="no-more" wx:else>
    <text>çƒåœºæ˜¯æœ‰åº•çº¿çš„</text>
  </view>
</view>

<!-- ä¸ªäººä¿¡æ¯å¼¹çª— -->
<view wx:if="{{showProfileModal}}" class="profile-modal-mask" catchtap="onCloseProfileModal">
  <view class="profile-modal">
    <view class="profile-title">ä¸ªäººä¿¡æ¯</view>
    <view class="profile-row">
      <view class="profile-label">å¤´åƒ</view>
      <image class="profile-avatar" src="{{profileUser.avatarUrl || profileUser.avatar}}" />
    </view>
    <view class="profile-row">
      <view class="profile-label">æ˜µç§°</view>
      <input class="profile-input" value="{{profileUser.nickName || profileUser.name}}" disabled />
    </view>
    <view class="profile-row">
      <view class="profile-label">æ€§åˆ«</view>
      <input class="profile-input" value="{{profileUser.gender || 'æœªçŸ¥'}}" disabled />
    </view>
    <view class="profile-row">
      <view class="profile-label">ç­‰çº§</view>
      <input class="profile-input" value="{{profileUser.level || 'æœªçŸ¥'}}" disabled />
    </view>
    <view class="profile-row">
      <view class="profile-label">ç”Ÿæ—¥</view>
      <input class="profile-input" value="{{profileUser.birthdate || 'æœªçŸ¥'}}" disabled />
    </view>
    <view class="profile-row">
      <view class="profile-label">å¹´é¾„</view>
      <input class="profile-input" value="{{profileUser.age || 'æœªçŸ¥'}}" disabled />
    </view>
  </view>
</view>

  